@name EZ Gear
@inputs Speed Reversing BreakInput ForwardInput HardBreak
@outputs SetGear SpeedRnd BreakOutput

SpeedRnd = round(Speed)

MaxGears = 9

Gear2Change = 10
Gear3Change = 28
Gear4Change = 48
Gear5Change = 67
Gear6Change = 200
Gear7Change = 200
Gear8Change = 200

Breaking = HardBreak + BreakInput

if (HardBreak == 1) {
    BreakOutput = 20
}
else {
    BreakOutput = BreakInput
}


if ((Breaking != 0) && (Speed < 20)) {
    SetGear = 0
}

else {
    if ((Reversing == 0) && (ForwardInput == 1)) {
        if (MaxGears >= 4) {
            if (SpeedRnd < Gear2Change) {
                SetGear = 1
            }
            if (SpeedRnd >= Gear2Change) {
                SetGear = 2
            }
            if (SpeedRnd >= Gear3Change) {
                SetGear = 3
            }
        }

        if (MaxGears >= 6) {
            if (SpeedRnd >= Gear4Change) {
                SetGear = 4
            }
            if (SpeedRnd >= Gear5Change) {
                SetGear = 5
            }
        }

        if (MaxGears >= 8) {
            if (SpeedRnd >= Gear6Change) {
                SetGear = 6
            }
            if (SpeedRnd >= Gear7Change) {
                SetGear = 7
            }
        }

        if (MaxGears >= 9) {
            if (SpeedRnd >= Gear8Change) {
                SetGear = 8
            }
        }
    }
    elseif (Reversing == 1) {
        SetGear = MaxGears
    }
}
